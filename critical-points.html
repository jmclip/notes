<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lecture 4 Critical points and approximation | Computational Math Camp</title>
<meta name="description" content="Learning objectives Define critical points Calculate critical points via analytical methods Demonstrate optimization using maximum likelihood estimation Identify need for approximation methods for...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Lecture 4 Critical points and approximation | Computational Math Camp">
<meta property="og:type" content="book">
<meta property="og:description" content="Learning objectives Define critical points Calculate critical points via analytical methods Demonstrate optimization using maximum likelihood estimation Identify need for approximation methods for...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lecture 4 Critical points and approximation | Computational Math Camp">
<meta name="twitter:description" content="Learning objectives Define critical points Calculate critical points via analytical methods Demonstrate optimization using maximum likelihood estimation Identify need for approximation methods for...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.0/transition.js"></script><script src="libs/bs3compat-0.5.0/tabs.js"></script><script src="libs/bs3compat-0.5.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
</head>
<body>
<p>
    \[
    \newcommand{\E}{\mathrm{E}}
    \newcommand{\Var}{\mathrm{Var}}
    \newcommand{\Cov}{\mathrm{Cov}}
    \newcommand{\se}{\text{se}}
    \newcommand{\sd}{\text{sd}}
    \newcommand{\Cor}{\mathrm{Cor}}
    \newcommand{\Lagr}{\mathcal{L}}
    \newcommand{\lagr}{\mathcal{l}}
    \]
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style><style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style><link rel="stylesheet" href="bs4.css"></p>

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Lecture Notes">Computational Math Camp</a>:
        <small class="text-muted">Lecture Notes</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled"><li><a class="" href="index.html"><span class="header-section-number">Lecture 4</span> Critical points and approximation</a></li></ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="critical-points" class="section level1" number="4">
<h1>
<span class="header-section-number">Lecture 4</span> Critical points and approximation<a class="anchor" aria-label="anchor" href="#critical-points"><i class="fas fa-link"></i></a>
</h1>
<div id="learning-objectives-2" class="section level2 unnumbered">
<h2>Learning objectives<a class="anchor" aria-label="anchor" href="#learning-objectives-2"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Define critical points</li>
<li>Calculate critical points via analytical methods</li>
<li>Demonstrate optimization using maximum likelihood estimation</li>
<li>Identify need for approximation methods for calculating critical points</li>
<li>Explain and demonstrate root finding procedures using Newton-Raphson hill climber</li>
<li>Demonstrate comptuational optimization using gradient descent</li>
</ul>
</div>
<div id="supplemental-readings-2" class="section level2 unnumbered">
<h2>Supplemental readings<a class="anchor" aria-label="anchor" href="#supplemental-readings-2"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Chapters 8, 9.1-.2, 10, <span class="citation">Pemberton and Rau (<a href="references.html#ref-pemberton2015">2011</a>)</span>
</li>
<li><a href="https://openstax.org/details/books/calculus-volume-1">OpenStax Calculus: Volume 1, ch 4</a></li>
</ul>
</div>
<div id="intuition" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Intuition<a class="anchor" aria-label="anchor" href="#intuition"><i class="fas fa-link"></i></a>
</h2>
<p>Recall <a href="sequences-derivatives.html#relative-maxima-minima-and-derivatives">Rolle’s Theorem</a>:</p>
<div class="theorem" echo="TRUE">
<p><span id="thm:unlabeled-div-1" class="theorem"><strong>Theorem 4.1  (Rolle's theorem) </strong></span>Suppose <span class="math inline">\(f:[a, b] \rightarrow \Re\)</span>. Suppose <span class="math inline">\(f\)</span> has a relative maxima or minima on <span class="math inline">\((a,b)\)</span> and call that <span class="math inline">\(c \in (a, b)\)</span>. Then <span class="math inline">\(f'(c) = 0\)</span>.</p>
</div>
<p>Intuition:</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/rolles-theorem-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Rolle’s theorem guarantee’s that, at some point, <span class="math inline">\(f^{'}(x) = 0\)</span>. Think about the intuition given this theorem. What happens as we approach from the left? What happens as we approach from the right?</p>
</div>
<div id="higher-order-derivatives" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Higher order derivatives<a class="anchor" aria-label="anchor" href="#higher-order-derivatives"><i class="fas fa-link"></i></a>
</h2>
<p>The first derivative is applying the definition of derivatives on the function, and it can be expressed as</p>
<p><span class="math display">\[f'(x),  ~~ y',  ~~ \frac{d}{dx}f(x), ~~ \frac{dy}{dx}\]</span></p>
<p>We can keep applying the differentiation process to functions that are themselves derivatives. The derivative of <span class="math inline">\(f'(x)\)</span> with respect to <span class="math inline">\(x\)</span>, would then be <span class="math display">\[f''(x)=\lim\limits_{h\to 0}\frac{f'(x+h)-f'(x)}{h}\]</span> and we can therefore call it the <strong>Second derivative:</strong></p>
<p><span class="math display">\[f''(x), ~~ y'', ~~ \frac{d^2}{dx^2}f(x), ~~ \frac{d^2y}{dx^2}\]</span></p>
<p>Similarly, the derivative of <span class="math inline">\(f''(x)\)</span> would be called the third derivative and is denoted <span class="math inline">\(f'''(x)\)</span>. And by extension, the <strong>nth derivative</strong> is expressed as <span class="math inline">\(\frac{d^n}{dx^n}f(x)\)</span>, <span class="math inline">\(\frac{d^ny}{dx^n}\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
f(x) &amp;=x^3\\
f^{\prime}(x) &amp;=3x^2\\
f^{\prime\prime}(x) &amp;=6x \\
f^{\prime\prime\prime}(x) &amp;=6\\
f^{\prime\prime\prime\prime}(x) &amp;=0\\
\end{aligned}
\]</span></p>
<p>Earlier, we said that <a href="sequences-derivatives.html#continuity-and-derivatives">if a function is differentiable at a given point, then it must be continuous</a>. Further, if <span class="math inline">\(f'(x)\)</span> is itself continuous, then <span class="math inline">\(f(x)\)</span> is called <strong>continuously differentiable</strong>. All of this matters because many of our findings about optimization rely on differentiation, and so we want our function to be differentiable in as many layers. A function that is continuously differentiable infinitely is called <strong>smooth</strong>. Some examples include:</p>
<p><span class="math display">\[
\begin{aligned}
f(x) &amp;= x^2 \\
f(x) &amp;= e^x
\end{aligned}
\]</span></p>
</div>
<div id="critical-points-1" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Critical points<a class="anchor" aria-label="anchor" href="#critical-points-1"><i class="fas fa-link"></i></a>
</h2>
<p>One important purpose of derivatives is to find <strong>critical points</strong> along a function. Critical points are points on the domain of a function where the function is either not differentiable or the derivative is equal to zero.</p>
<div id="inflection-point" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Inflection point<a class="anchor" aria-label="anchor" href="#inflection-point"><i class="fas fa-link"></i></a>
</h3>
<p>For a given function <span class="math inline">\(y = f(x)\)</span>, a point <span class="math inline">\((x^∗, y^∗)\)</span> is called an <strong>inflection point</strong> if the second derivative immediately on one side of the point is signed oppositely to the second derivative immediately on the other side. Graphically, this occurs if the tangent line switches sides of the function at the inflection point.</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/inflect-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="concavity" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Concavity<a class="anchor" aria-label="anchor" href="#concavity"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>
<strong>Concave up </strong>(convex) - for a segment of a function, every possible <strong>chord</strong> (line segment connecting points along <span class="math inline">\(f(x)\)</span>) is above the function</li>
<li>
<strong>Concave down</strong> (concave) - for a segment of a function, every possible chord is below the function</li>
</ul>
<p>This can be verified both graphically and analytically using the second derivative. Where a function is twice differentiable and concave over some area, then the function is concave down where <span class="math inline">\(f''(x) &lt; 0\)</span> and concave up where <span class="math inline">\(f''(x) &gt; 0\)</span>.</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/concave-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Some functions are <strong>strictly concave up</strong> or <strong>concave down</strong> if the second derivative is constantly signed over the entire domain of <span class="math inline">\(x\)</span>.</p>
<div id="exponential-function-concave-up" class="section level5" number="4.3.2.0.1">
<h5>
<span class="header-section-number">4.3.2.0.1</span> Exponential function (concave up)<a class="anchor" aria-label="anchor" href="#exponential-function-concave-up"><i class="fas fa-link"></i></a>
</h5>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/strict-e-1.png" width="90%" style="display: block; margin: auto;"></div>
<p><span class="math display">\[
\begin{aligned}
f(x) &amp; =  e^{x} \\
f^{'}(x) &amp; =  e^{x} \\
f^{''}(x) &amp; =  e^{x}
\end{aligned}
\]</span></p>
</div>
<div id="natural-log-concave-down" class="section level5" number="4.3.2.0.2">
<h5>
<span class="header-section-number">4.3.2.0.2</span> Natural log (concave down)<a class="anchor" aria-label="anchor" href="#natural-log-concave-down"><i class="fas fa-link"></i></a>
</h5>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/strict-log-1.png" width="90%" style="display: block; margin: auto;"></div>
<p><span class="math display">\[
\begin{aligned}
f(x) &amp; =  \log(x) \\
f^{'}(x) &amp; =  \frac{1}{x} \\
f^{''}(x) &amp; =  -\frac{1}{x^2}
\end{aligned}
\]</span></p>
</div>
</div>
</div>
<div id="extrema" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Extrema<a class="anchor" aria-label="anchor" href="#extrema"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Extreme values</strong> are values of a function that are either the maximum or minimum value.</p>
<div class="theorem" echo="TRUE">
<p><span id="thm:unlabeled-div-2" class="theorem"><strong>Theorem 4.2  (Extreme value theorem) </strong></span>Suppose <span class="math inline">\(f:[a, b] \rightarrow \Re\)</span>. There exists numbers <span class="math inline">\(c\)</span> and <span class="math inline">\(d\)</span> in <span class="math inline">\([a, b]\)</span> such that <span class="math inline">\(f(c) \ge f(x) \ge f(d)\quad\forall x\in [a,b]\)</span>. That is, <span class="math inline">\(f\)</span> must attain a maximum and a minimum, each at least once.</p>
</div>
<p>These values can be locally or (potentially) globally across the entire domain of <span class="math inline">\(f\)</span>.</p>
<div id="minimum-and-maximum-on-the-interval-05-are-located-at-the-endpoints" class="section level3" number="4.4.1">
<h3>
<span class="header-section-number">4.4.1</span> Minimum and maximum on the interval <span class="math inline">\([0,5]\)</span> are located at the endpoints<a class="anchor" aria-label="anchor" href="#minimum-and-maximum-on-the-interval-05-are-located-at-the-endpoints"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/endpoints-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="global-maximum-is-located-at-x0" class="section level3" number="4.4.2">
<h3>
<span class="header-section-number">4.4.2</span> Global maximum is located at <span class="math inline">\(x=0\)</span><a class="anchor" aria-label="anchor" href="#global-maximum-is-located-at-x0"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/max-middle-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="global-minimum-is-located-at-x---frac92" class="section level3" number="4.4.3">
<h3>
<span class="header-section-number">4.4.3</span> Global minimum is located at <span class="math inline">\(x= - \frac{9}{2}\)</span><a class="anchor" aria-label="anchor" href="#global-minimum-is-located-at-x---frac92"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/min-middle-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="a-bunch-of-local-minima-and-maxima" class="section level3" number="4.4.4">
<h3>
<span class="header-section-number">4.4.4</span> A bunch of local minima and maxima<a class="anchor" aria-label="anchor" href="#a-bunch-of-local-minima-and-maxima"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/local-all-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="x0-is-an-inflection-point-that-is-neither-a-minimum-nor-a-maximum-fx-0" class="section level3" number="4.4.5">
<h3>
<span class="header-section-number">4.4.5</span> <span class="math inline">\(x=0\)</span> is an inflection point that is neither a minimum nor a maximum (<span class="math inline">\(f''(x) = 0\)</span>)<a class="anchor" aria-label="anchor" href="#x0-is-an-inflection-point-that-is-neither-a-minimum-nor-a-maximum-fx-0"><i class="fas fa-link"></i></a>
</h3>
<p>Also known as a <strong>saddle point</strong>.</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/inflection-point-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="framework-for-analytical-optimization" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Framework for analytical optimization<a class="anchor" aria-label="anchor" href="#framework-for-analytical-optimization"><i class="fas fa-link"></i></a>
</h2>
<p>Here we see how critical points can be used to find extrema and saddle points.</p>
<ol style="list-style-type: decimal">
<li>Find <span class="math inline">\(f'(x)\)</span>
</li>
<li>Set <span class="math inline">\(f'(x)=0\)</span> and solve for <span class="math inline">\(x\)</span>. Call all <span class="math inline">\(x_0\)</span> such that <span class="math inline">\(f'(x_0)=0\)</span> <strong>critical values</strong>
</li>
<li>Find <span class="math inline">\(f''(x)\)</span>. Evaluate at each <span class="math inline">\(x_0\)</span>
<ul>
<li>If <span class="math inline">\(f''(x) &gt; 0\)</span>, concave up, and therefore a local minimum</li>
<li>If <span class="math inline">\(f''(x) &lt; 0\)</span>, concave down, and therefore a local maximum</li>
<li>If it’s the global maximum/minimum, it will produce the largest/smallest value for <span class="math inline">\(f(x)\)</span>
</li>
<li>On a closed range along the domain, check the endpoints as well</li>
</ul>
</li>
</ol>
<div id="example-fx--x2-x-in--3-3" class="section level3" number="4.5.1">
<h3>
<span class="header-section-number">4.5.1</span> Example: <span class="math inline">\(f(x) = -x^2\)</span>, <span class="math inline">\(x \in [-3, 3]\)</span><a class="anchor" aria-label="anchor" href="#example-fx--x2-x-in--3-3"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/ex-1-1.png" width="90%" style="display: block; margin: auto;"></div>
<div id="critical-value" class="section level4" number="4.5.1.1">
<h4>
<span class="header-section-number">4.5.1.1</span> Critical Value<a class="anchor" aria-label="anchor" href="#critical-value"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[
\begin{eqnarray}
f'(x) &amp; = &amp; - 2 x  \\
0 &amp; = &amp; - 2 x^{*}  \\
x^{*} &amp; = &amp; 0
\end{eqnarray}
\]</span></p>
</div>
<div id="second-derivative" class="section level4" number="4.5.1.2">
<h4>
<span class="header-section-number">4.5.1.2</span> Second Derivative<a class="anchor" aria-label="anchor" href="#second-derivative"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[
\begin{eqnarray}
f^{'}(x) &amp; = &amp; - 2x  \\
f^{''}(x)  &amp; = &amp; - 2  
\end{eqnarray}
\]</span></p>
<ul>
<li>
<span class="math inline">\(f^{''}(x)&lt; 0\)</span>, local maximum</li>
</ul>
</div>
</div>
<div id="example-fx-x3-x-in--3-3" class="section level3" number="4.5.2">
<h3>
<span class="header-section-number">4.5.2</span> Example: <span class="math inline">\(f(x) = x^3\)</span>, <span class="math inline">\(x \in [-3, 3]\)</span><a class="anchor" aria-label="anchor" href="#example-fx-x3-x-in--3-3"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/ex-2-1.png" width="90%" style="display: block; margin: auto;"></div>
<div id="critical-value-1" class="section level4" number="4.5.2.1">
<h4>
<span class="header-section-number">4.5.2.1</span> Critical Value<a class="anchor" aria-label="anchor" href="#critical-value-1"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[
\begin{eqnarray}
f'(x) &amp; = &amp; 3 x^2  \\
0 &amp; = &amp; 3 (x^{*})^2  \\
x^{*} &amp; = &amp; 0
\end{eqnarray}
\]</span></p>
</div>
<div id="second-derivative-1" class="section level4" number="4.5.2.2">
<h4>
<span class="header-section-number">4.5.2.2</span> Second Derivative<a class="anchor" aria-label="anchor" href="#second-derivative-1"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[
\begin{eqnarray}
f^{''}(x) &amp; = &amp; 6x  \\
f^{''}(0)  &amp; = &amp; 0
\end{eqnarray}
\]</span></p>
<ul>
<li>Neither a minimum nor a maximum, it is a <strong>saddle point</strong>
</li>
</ul>
</div>
</div>
<div id="example-spatial-model" class="section level3" number="4.5.3">
<h3>
<span class="header-section-number">4.5.3</span> Example: spatial model<a class="anchor" aria-label="anchor" href="#example-spatial-model"><i class="fas fa-link"></i></a>
</h3>
<p>A large literature in Congress supposes legislators and policies can be situated in a <strong>policy space</strong>. Suppose legislator <span class="math inline">\(i\)</span> and policies <span class="math inline">\(x, i \in \Re\)</span>. Define legislator <span class="math inline">\(i\)</span>’s utility as, <span class="math inline">\(U:\Re \rightarrow \Re\)</span>,</p>
<p><span class="math display">\[
\begin{aligned}
U_{i} (x) &amp; = - (x - \mu)^{2} \\
U_{i}(x) &amp; = - x^2 +  2 x \mu  - \mu^2
\end{aligned}
\]</span></p>
<p>What is <span class="math inline">\(i\)</span>’s optimal policy over the range <span class="math inline">\(x \in [\mu- 2, \mu + 2]\)</span>?</p>
<div id="first-derivative" class="section level4" number="4.5.3.1">
<h4>
<span class="header-section-number">4.5.3.1</span> First derivative<a class="anchor" aria-label="anchor" href="#first-derivative"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[
\begin{aligned}
U_{i}^{'} (x) &amp; = -2 (x - \mu) \\
0 &amp; = -2x^{*} + 2 \mu \\
x^{*} &amp; = \mu
\end{aligned}
\]</span></p>
</div>
<div id="second-derivative-test" class="section level4" number="4.5.3.2">
<h4>
<span class="header-section-number">4.5.3.2</span> Second derivative test<a class="anchor" aria-label="anchor" href="#second-derivative-test"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[U^{''}_{i}(x) = -2 &lt;0 \rightarrow \text{Concave Down}\]</span></p>
<p>We call <span class="math inline">\(\mu\)</span> legislator <span class="math inline">\(i\)</span>’s <strong>ideal point</strong></p>
<p><span class="math display">\[
\begin{aligned}
U_{i}(\mu) &amp; = - (\mu - \mu)^2 = 0  \\
U_{i}(\mu - 2) &amp; = - (\mu - 2 - \mu)^2 = -4  \\
U_{i} (\mu + 2) &amp; = - (\mu + 2 - \mu)^2 = -4  
\end{aligned}
\]</span></p>
<p>The legislator maximizes her utility at <span class="math inline">\(\mu\)</span>.</p>
</div>
</div>
<div id="example-maximum-likelihood-estimation" class="section level3" number="4.5.4">
<h3>
<span class="header-section-number">4.5.4</span> Example: Maximum likelihood estimation<a class="anchor" aria-label="anchor" href="#example-maximum-likelihood-estimation"><i class="fas fa-link"></i></a>
</h3>
<p>A <strong>likelihood function</strong> is a function for calculating the parameters of a statistical model, given specific observed data. As we’ll see in a few days, likelihood is related to, but not the same as, probability. Under frequentist inference:</p>
<ul>
<li>Probability is the plausibility of a random outcome occurring, given a model parameter value</li>
<li>Likelihood is the plausibility of a model parameter(s) value, given specific observed value</li>
</ul>
<p>Generally in these problems the data is known but the parameters are unknown. In order to estimate the best values for the parameters, we can use optimization to <strong>maximize</strong> the function to find the values for the function located at the global maximum of the likelihood function.</p>
<p>Here is an example likelihood function. We want to find the <strong>maximum likelihood estimate</strong> for the function:<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Note that this is the likelihood function for a normal distribution with the variance parameter held constant. This allows us to eliminate the variance parameter from the equation and simplify the procedure. This process would work with both parameters, if we were doing partial derivatives and finding them simultaneously. &lt;a href="multivariable-differentiation.html#maximum-likelihood-estimation-for-a-normal-distribution"&gt;We’ll revisit this soon.&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a></p>
<p><span class="math display">\[
\begin{aligned}
f(\mu) &amp; = \prod_{i=1}^{N} \exp( \frac{-(Y_{i} - \mu)^2}{ 2}) \\
&amp; = \exp(- \frac{(Y_{1} - \mu)^2}{ 2}) \times \ldots \times \exp(- \frac{(Y_{N} - \mu)^2}{ 2}) \\
&amp; = \exp( - \frac{\sum_{i=1}^{N} (Y_{i} - \mu)^2} {2})
\end{aligned}
\]</span></p>

<div class="rmdnote">
<p><span class="math display">\[\exp(x) \equiv e^{x}\]</span></p>
<span class="math inline">\(\exp()\)</span> is a more compact notation used commonly when the exponent is a fractional value.
</div>

<div class="rmdnote">
<ul>
<li>
<span class="math inline">\(\prod_{i=1}^{N}\)</span> is the product over all observations.</li>
<li>We can rewrite the function as the sum <span class="math inline">\(\sum_{i=1}^{N} (Y_{i} - \mu)^2\)</span> because of the multiplicative exponents rule.
</li>
</ul>
</div>

<p>This value will be very very very small (exponentiation to a negative exponent). Trying to find the maximum when <span class="math inline">\(f(\mu)\)</span> only has very slight changes across different values of <span class="math inline">\(\mu\)</span> is extremely difficult. However, suppose <span class="math inline">\(f:\Re \rightarrow (0, \infty)\)</span>. If <span class="math inline">\(x_{0}\)</span> maximizes <span class="math inline">\(f\)</span>, then <span class="math inline">\(x_{0}\)</span> maximizes <span class="math inline">\(\log(f(x))\)</span>. That is, we don’t need the exact value of the likelihood function, just the value for <span class="math inline">\(\mu\)</span> where it is maximized. That value <span class="math inline">\(\mu^{*}\)</span> will be the same for either function, so instead of maximizing the likelihood <strong>we’ll maximize the log-likelihood</strong>.</p>
<p><span class="math display">\[
\begin{aligned}
\log f(\mu) &amp; = \log \left( \exp( - \frac{\sum_{i=1}^{N} (Y_{i} - \mu)^2} {2}) \right)  \\
&amp; = - \frac{\sum_{i=1}^{N} (Y_{i} - \mu)^2} {2} \\
    &amp; = -\frac{1}{2} \left(\sum_{i=1}^{N} Y_{i}^2 - 2\mu \sum_{i=1}^{N} Y_{i} + N\times\mu^2 \right) \\
\frac{ \partial \log f(\mu) }{ \partial \mu } &amp; =       -\frac{1}{2} \left( - 2\sum_{i=1}^{N} Y_{i} + 2 N \mu \right)
\end{aligned}
\]</span></p>
<ul>
<li><span class="math inline">\(\log{e^{f(x)}} = f(x)\)</span></li>
<li>Expand terms in the summation, then separate into separate terms
<ul>
<li><span class="math inline">\(\sum_{i = 1}^N \mu^1 = N \times \mu^2\)</span></li>
</ul>
</li>
<li>Calculate the derivative
<ul>
<li>
<span class="math inline">\(\sum_{i=1}^{N} Y_{i}^2\)</span> is a constant with respect to <span class="math inline">\(\mu\)</span> and drops out</li>
</ul>
</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
0 &amp; = -\frac{1}{2} \left( - 2 \sum_{i=1}^{N} Y_{i} + 2 N \mu^{*} \right) \\
0 &amp; = \sum_{i=1}^{N} Y_{i} - N \mu^{*}  \\
N \mu^{*}  &amp; =  \sum_{i=1}^{N}Y_{i} \\
\mu^{*} &amp; = \frac{\sum_{i=1}^{N}Y_{i}}{N} \\
\mu^{*} &amp; = \bar{Y}
\end{aligned}
\]</span></p>
<p>Apply the second derivative test:</p>
<p><span class="math display">\[
\begin{aligned}
f^{'}(\mu ) &amp; = -\frac{1}{2} \left( - 2\sum_{i=1}^{N} Y_{i} + 2 N \mu \right) \\
f^{'}(\mu ) &amp; = \sum_{i=1}^{N} Y_{i} - N \mu \\
f^{''}(\mu ) &amp; = -N
\end{aligned}
\]</span></p>
<p><span class="math inline">\(-N&lt;0\)</span>, so the function is concave down at this point and therefore it is a <strong>maximum</strong>. The arithmetic mean of <span class="math inline">\(Y\)</span> is the maximum likelihood estimator for the variable.</p>
</div>
</div>
<div id="computational-optimization-procedures" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Computational optimization procedures<a class="anchor" aria-label="anchor" href="#computational-optimization-procedures"><i class="fas fa-link"></i></a>
</h2>
<p>Analytic approaches can be difficult or impossible for most applications in the social sciences. Computational approaches simplify the problem through various forms of approximations. Different algorithms are available with benefits/drawbacks. Some examples include:</p>
<ul>
<li>Newton-Raphson - expensive</li>
<li>Grid search - tedious</li>
<li>Gradient descent - parallelizable</li>
</ul>
<div id="newton-raphson-root-finding" class="section level3" number="4.6.1">
<h3>
<span class="header-section-number">4.6.1</span> Newton-Raphson root finding<a class="anchor" aria-label="anchor" href="#newton-raphson-root-finding"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Roots</strong> are values of the function <span class="math inline">\(f(x)\)</span> where <span class="math inline">\(f(x) = 0\)</span>, where the function crosses the <span class="math inline">\(x\)</span>-axis. Root solving is necessary to optimize a function since we first have to calculate the first derivative <span class="math inline">\(f'(x)\)</span>, set it equal to 0, and solve for <span class="math inline">\(x^{*}\)</span>.</p>
<p>However, this is not always a realistic method or easy to compute value. Instead, we can use general iterative procedures to <strong>approximate</strong> <span class="math inline">\(x^{*}\)</span>, with decent reliability. <strong>Newton’s method</strong> (also called <strong>Newton-Raphson</strong> or a <strong>Newton-Raphson hill climber</strong>) is one such procedure that relies on <strong>Taylor series expansion</strong> to iterate over a series of possible <span class="math inline">\(x^{*}\)</span> values until converging on the final estimate.</p>
<div id="tangent-lines" class="section level4" number="4.6.1.1">
<h4>
<span class="header-section-number">4.6.1.1</span> Tangent lines<a class="anchor" aria-label="anchor" href="#tangent-lines"><i class="fas fa-link"></i></a>
</h4>
<p>Solving for <span class="math inline">\(f(x) = 0\)</span> can be challenging when <span class="math inline">\(f(x)\)</span> is a non-linear function. However, solving for <span class="math inline">\(x\)</span> when <span class="math inline">\(f(x)\)</span> is linear is relatively easy. If we can approximate the function <span class="math inline">\(f(x)\)</span> using linear functions, the problem becomes less difficult.</p>
<p>To start, we define the <strong>tangent</strong> at a point as the line through that point whose slope is the slope of the curve.</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/tangent-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/tangent-anim-1.gif" width="90%" style="display: block; margin: auto;"></div>
<p>The formula for a tangent line at <span class="math inline">\(x_0\)</span> is:</p>
<p><span class="math display">\[g(x) = f^{'}(x_{0}) (x - x_{0} ) + f(x_{0})\]</span></p>
<p>We’ll use the formula for a tangent line to generate updates.</p>
</div>
<div id="newton-raphson-method" class="section level4" number="4.6.1.2">
<h4>
<span class="header-section-number">4.6.1.2</span> Newton-Raphson method<a class="anchor" aria-label="anchor" href="#newton-raphson-method"><i class="fas fa-link"></i></a>
</h4>
<p>Suppose we have some initial guess <span class="math inline">\(x_{0}\)</span>. We’re going to approximate <span class="math inline">\(f(x)\)</span> with the tangent line to generate a new guess:</p>
<p><span class="math display">\[
\begin{aligned}
g(x) &amp; = f^{'}(x_{0})(x - x_{0} ) + f(x_{0} ) \\
0 &amp; = f^{'}(x_{0}) (x_{1} - x_{0}) + f(x_{0} ) \\
x_{1} &amp; =  x_{0} - \frac{f(x_{0}) }{f^{'}(x_{0})}
\end{aligned}
\]</span></p>
<p>The procedure is algorithmic and iterative because our initial guess for <span class="math inline">\(x_1\)</span> will not be optimal. However, we can use the same procedure multiple times substituting the new value for <span class="math inline">\(x_1\)</span> into the function as <span class="math inline">\(x_0\)</span> and updating <span class="math inline">\(x_1\)</span>. Repeat this step sufficiently until <span class="math inline">\(f(x_{j+1})\)</span> is sufficiently close to zero, then stop.</p>
</div>
<div id="example-y--x2" class="section level4" number="4.6.1.3">
<h4>
<span class="header-section-number">4.6.1.3</span> Example: <span class="math inline">\(y = -x^2\)</span><a class="anchor" aria-label="anchor" href="#example-y--x2"><i class="fas fa-link"></i></a>
</h4>
<p>Let’s learn Newton’s method using some arbitrary function. The only requirement we want to impose is that this function has to be twice differentiable (you will soon notice why). Say we want to optimize the following arbitrary function:</p>
<p><span class="math display">\[y = -x^2\]</span></p>
<p>The first derivative of this function is <span class="math inline">\(\frac{\partial y}{\partial x} = -2x\)</span>.</p>
<p>The second derivative is <span class="math inline">\(\frac{\partial^2 y}{\partial x^2} = -2\)</span></p>
<p>This function looks like this:</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/base-plot-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>We want to use Newton-Raphson to find the critical point:</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/optims-1.png" width="90%" style="display: block; margin: auto;"></div>
<div id="implementing-newton-raphson" class="section level5" number="4.6.1.3.1">
<h5>
<span class="header-section-number">4.6.1.3.1</span> Implementing Newton-Raphson<a class="anchor" aria-label="anchor" href="#implementing-newton-raphson"><i class="fas fa-link"></i></a>
</h5>
<p>Recall that given a starting value <span class="math inline">\(x_0\)</span>, we determine the next guess of the optimum of our function <span class="math inline">\(f(x)\)</span> using the following equation:</p>
<p><span class="math display">\[x_1 = x_0 - \frac{f'(x_0)}{f''(x_0)}\]</span></p>

<div class="rmdnote">
Here the base function is <span class="math inline">\(f'(x_0)\)</span> because we want to solve for the roots of <span class="math inline">\(f'(x)\)</span>.
</div>
<p>Or, more generally, for the <span class="math inline">\((n+1)^{th}\)</span> guess, use</p>
<p><span class="math display">\[x_{n+1} = x_n - \frac{f'(x_n)}{f''(x_n)}\]</span></p>
<p>Given our function,</p>
<p><span class="math display">\[x_{n+1} = x_n - \frac{-2x}{-2}\]</span></p>
<p>We want to continue looking for new guesses till the difference between a guess and the previous one is sufficiently small. For example, say we want to stick to a guess <span class="math inline">\(x_n\)</span> if <span class="math inline">\(\mid x_n - x_{n-1} \mid &lt; 0.0001\)</span>.</p>
<p>Let’s find the maximum of our function. Let’s start with a relatively high guess of <span class="math inline">\(x_0 = 3\)</span>:</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/first-func-first-guess-1.gif" width="90%" style="display: block; margin: auto;"></div>
<p>This gives us the maximum. If we plug it into the second derivative, we see that the value <span class="math inline">\(-2\)</span> is a local maximum because the second derivative evaluated at this point is negative. Moreover, we find that the first derivative evaluated at this point (<span class="math inline">\(-2\)</span>) is (very close to) zero.</p>
</div>
</div>
<div id="example-y-x3-2x2---3x-4" class="section level4" number="4.6.1.4">
<h4>
<span class="header-section-number">4.6.1.4</span> Example: <span class="math inline">\(y = x^3 + 2x^2 - 3x + 4\)</span><a class="anchor" aria-label="anchor" href="#example-y-x3-2x2---3x-4"><i class="fas fa-link"></i></a>
</h4>
<p>Now let’s consider the function</p>
<p><span class="math display">\[y = x^3 + 2x^2 - 3x + 4\]</span></p>
<p>The first derivative of this function is <span class="math inline">\(\frac{\partial y}{\partial x} = 3x^2 + 4x - 3\)</span>.</p>
<p>The second derivative is <span class="math inline">\(\frac{\partial^2 y}{\partial x^2} = 6x + 4\)</span></p>
<p>This function looks like this:</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/base-plot-two-points-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>We want to use Newton-Raphson to find the following two points (optima):</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/optims-two-points-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Given our function,</p>
<p><span class="math display">\[x_{n+1} = x_n - \frac{3x_n^2 + 4x_n - 3}{6x_n + 4}\]</span></p>
<p>Let’s start with an initial guess <span class="math inline">\(x_0 = 10\)</span>:</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/second-func-first-guess-1.gif" width="90%" style="display: block; margin: auto;"></div>
<p>This gives us the first point: <span class="math inline">\(x \approx 0.535\)</span>. If we plug it into the second derivative, we see that the value is a local minimum because the second derivative evaluated at this point is positive (<span class="math inline">\(7.211\)</span>). Moreover, we find that the first derivative evaluated at this point (<span class="math inline">\(4.441\times 10^{-16}\)</span>) is (very close to) zero.</p>
<p>However this function also has a second critical value: a local maximum. Let’s try to find the second optimum by plugging a negative value (<span class="math inline">\(x_0 = -10\)</span>) into our Newton-Raphson function:</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/second-func-second-guess-1.gif" width="90%" style="display: block; margin: auto;"></div>
<p>Again, we can plug in this point into second derivative to confirm that this is a local maximum (<span class="math inline">\(-15.706\)</span>).</p>
<p>The key point here is that Newton-Raphson is not guaranteed to find a global minimum/maximum, nor is it even guaranteed to find a specific critical point. When you use this procedure, you should initialize the algorithm with several different <span class="math inline">\(x_0\)</span> to verify if they converge on the same or differing answers.</p>
</div>
</div>
<div id="grid-search" class="section level3" number="4.6.2">
<h3>
<span class="header-section-number">4.6.2</span> Grid search<a class="anchor" aria-label="anchor" href="#grid-search"><i class="fas fa-link"></i></a>
</h3>
<p>A <strong>grid search</strong> is an exhaustive search algorithm for maximizing/minimizing a function. It works by defining a specified set of <span class="math inline">\(x_i\)</span>, calculating <span class="math inline">\(f(x_i)\)</span>, and comparing all the resulting values to determine which is largest/smallest.</p>
<p>Consider again the function</p>
<p><span class="math display">\[y = -x^2\]</span></p>
<p>We can evaluate the function for all <span class="math inline">\(x \in \{ -2, -1.99, -1.98, \ldots, 1.98, 1.99, 2 \}\)</span> and determine which <span class="math inline">\(x_i\)</span> generates the largest value.</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/grid-search-1.gif" width="90%" style="display: block; margin: auto;"></div>
<p>For a simple example such as this, the method works reasonably well. However it is also computationally inefficient as you have to calculate <span class="math inline">\(f(x)\)</span> for all reasonable values of <span class="math inline">\(x\)</span>. If you do not have a reasonable starting point for your search, you have to search over an extremely large range of values. For this reason, grid searches – while simple – also tend to be disfavored.</p>
</div>
<div id="gradient-descent" class="section level3" number="4.6.3">
<h3>
<span class="header-section-number">4.6.3</span> Gradient descent<a class="anchor" aria-label="anchor" href="#gradient-descent"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s start with the function<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Source: &lt;a href="http://ethen8181.github.io/machine-learning/linear_regression/linear_regession.html" class="uri"&gt;http://ethen8181.github.io/machine-learning/linear_regression/linear_regession.html&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a></p>
<p><span class="math display">\[f(x) = 1.2 x^2 - 4.8 x + 8\]</span></p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/grad-ex-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>We could solve this analytically:</p>
<p><span class="math display">\[
\begin{aligned}
f'(x) &amp;= 2.4x - 4.8 \\
0 &amp;= 2.4x - 4.8 \\
4.8 &amp;= 2.4x \\
x &amp;= 2
\end{aligned}
\]</span></p>
<p>According to the second derivative test,</p>
<p><span class="math display">\[
\begin{aligned}
f''(x) &amp;= 2.4 \\
f''(2) &amp;= 2.4
\end{aligned}
\]</span></p>
<p><span class="math inline">\(f''(2) &gt; 0\)</span>, so <span class="math inline">\(x=2\)</span> is a minimum. This is easy if the function is simple. If the function is complicated, we can use a technique called <strong>gradient descent</strong>.</p>
<p><span class="math display">\[
x_1 = x_0 - \alpha f'(x_0)
\]</span></p>
<ul>
<li>
<span class="math inline">\(f'(x)\)</span> - first derivative (gradient) of the function</li>
<li>
<span class="math inline">\(\alpha\)</span> - learning rate (set manually)</li>
</ul>
<p>Like Newton’s method, gradient descent is an iterative algorithm. You repeat the process until the algorithm converges on a stable solution. Unlike Newton’s method, the rate of learning is controlled by the first derivative and the learning rate, not the second derivative <span class="math inline">\(f''(x)\)</span>.</p>
<p>Imagine gradient descent as when you’re at the top of a mountain and you want to get down to the very bottom, you have to choose two things. First the direction you wish to descend and second the size of the steps you wish to take. After choosing both of these things, you will keep on taking that step size and that direction until you reach the bottom.</p>
<p><span class="math inline">\(\alpha\)</span> corresponds to the size of the steps you wish to take and <span class="math inline">\(f'(x)\)</span> gives you the direction that you should take for your given formula. Note that in order for the formula to start calculating you will have to assign an initial value for <span class="math inline">\(x\)</span>.</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/grad-descent-learn-rate-6-1.gif" width="90%" style="display: block; margin: auto;"></div>
<p>Compare this same function using gradient descent and a learning rate of <span class="math inline">\(\alpha = 0.1\)</span>:</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/grad-descent-learn-rate-2-1.gif" width="90%" style="display: block; margin: auto;"></div>
<p>The algorithm converges more slowly the smaller the learning rate. In many contexts, you will use a different learning rate. A learning rate that is too high can cause the algorithm to converge too quickly to a suboptimal solution (such as a local minima as opposed to a global minima), whereas a learning rate that is too small can cause the process to get stuck. Consider the example below with a higher learning rate:</p>
<div class="inline-figure"><img src="03-critical-points_files/figure-html/grad-descent-learn-rate-wrong-1.gif" width="90%" style="display: block; margin: auto;"></div>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="empty"></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Computational Math Camp</strong>: Lecture Notes" was written by . It was last built on 2022-09-05.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
